{% extends 'base.html' %}
{% block content %}
<div class="container">
    <h2>{{ 'Edit' if edit else 'Add New' }} Clamp Entry</h2>
    <form method="POST" action="{{ url_for('add_clamp') if not edit else url_for('edit_clamp', id=clamp.id) }}" class="form" enctype="multipart/form-data">
        <div class="form-group">
            <label for="location">Location:</label>
            <input type="text" id="location" name="location" value="{{ clamp.location if edit else '' }}" required>
        </div>

        <div class="form-group">
            <label for="registration">Registration:</label>
            <input type="text" id="registration" name="registration" value="{{ clamp.registration if edit else '' }}">
        </div>

        <div class="form-group">
            <label for="clamp_date">Date:</label>
            <input type="date" id="clamp_date" name="clamp_date" value="{{ clamp.clamp_date.strftime('%Y-%m-%d') if edit else '' }}" required>
        </div>

        <div class="form-group">
            <label for="time_in">Time In:</label>
            <input type="time" id="time_in" name="time_in" value="{{ clamp.time_in.strftime('%H:%M') if edit and clamp.time_in else '' }}" required>
        </div>

        <div class="form-group">
            <label for="time_called">Time Called:</label>
            <input type="time" id="time_called" name="time_called" value="{{ clamp.time_called.strftime('%H:%M') if edit and clamp.time_called else '' }}">
        </div>

        <div class="form-group">
            <label for="car_type">Car Type:</label>
            <input type="text" id="car_type" name="car_type" value="{{ clamp.car_type if edit else '' }}">
        </div>

        <div class="form-group">
            <label for="color">Color:</label>
            <input type="text" id="color" name="color" value="{{ clamp.color if edit else '' }}">
        </div>

        <div class="form-group">
            <label for="clamp_ref">Clamp Reference Code:</label>
            <input type="text" id="clamp_ref" name="clamp_ref" value="{{ clamp.clamp_ref if edit else '' }}">
        </div>

        <div class="form-group">
            <label for="image">Photo (optional):</label>
            {% if edit and clamp.image_filename %}
            <div>
                <img src="{{ url_for('static', filename=clamp.image_filename) }}" alt="current image" style="max-width:200px;display:block;margin-bottom:8px;">
            </div>
            {% endif %}
            <input type="file" id="image" name="image" accept="image/*">
        </div>

        <div class="form-group">
            <label for="time_released">Time Released:</label>
            <input type="time" id="time_released" name="time_released" value="{{ clamp.time_released.strftime('%H:%M') if edit and clamp.time_released else '' }}">
        </div>

        <div class="form-group">
            <label for="offense">Offense:</label>
            <textarea id="offense" name="offense" required>{{ clamp.offense if edit else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="payment_status">Payment Status:</label>
            <select id="payment_status" name="payment_status">
                <option value="Processing" {% if edit and clamp.payment_status == 'Processing' %}selected{% endif %}>Processing</option>
                <option value="Paid" {% if edit and clamp.payment_status == 'Paid' %}selected{% endif %}>Paid</option>
                <option value="Not Paid" {% if edit and clamp.payment_status == 'Not Paid' %}selected{% endif %}>Not Paid</option>
            </select>
        </div>

        <div class="form-group">
            <label for="amount_paid">Amount Paid (USD):</label>
            <input type="number" step="0.01" min="0" id="amount_paid" name="amount_paid" value="{{ '%.2f'|format(clamp.amount_paid) if edit else '0.00' }}">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{{ 'Update' if edit else 'Add' }} Entry</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
